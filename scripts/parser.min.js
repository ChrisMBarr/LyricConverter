var parser=function(){function t(t,n){var r=n.data,i=n.name;try{var s=i.split("."),o=s[0],u=s.slice(-1)[0].toLowerCase(),a;$.each(parser.formats,function(e,t){if(t.testExtension(u)){a=t.convert;return!1}});if($.isFunction(a)){var f=r.replace(/^data:.*;base64,/,""),l=e.decode(f);parser.songList.push({name:o,data:a(l,o)})}else parser.errorList.push("The file <strong>"+i+"</strong> cannot be parsed because <strong>."+u.toUpperCase()+"</strong> files are not supported!")}catch(c){parser.errorList.push("There was an error reading the file <strong>"+i+"</strong>")}}function n(e){parser.songList.length&&parser.outputs[parser.outputFormat](e,parser.songList)}var e={decode:function(e){var t=window.atob(e);try{return decodeURIComponent(escape(t))}catch(n){return t}},encode:function(e){return window.btoa(unescape(encodeURIComponent(e)))}};return{utilities:e,parseFile:t,complete:n,outputFormat:null,displayError:null,songList:[],errorList:[],formats:{},outputs:{}}}();(function(){function r(e,t,r){var i=e.split(n);i=$.grep(i,function(e){var t=$.trim(e).replace(/\r\n\t/g,"");return t.length>1?t:!1});/[0-9]{1,4}/.test(i[0])&&i.splice(0,1);var s=i[0].length>0?i[0]:r,o=[];o.push({name:"Artist/Author",value:i[1]});i[2]&&o.push({name:"Copyright",value:i[2].replace("$","")});i[3]&&o.push({name:"CCLI",value:i[3]});t&&o.push({name:"Keywords",value:t});return{info:o,title:s}}function i(e){var r=new RegExp("^"+t+"+.{1}"+t+"+(.+)"+t+"+\\W*([\\s\\S]+)","m"),i=[];for(var o=1;o<e.length;o++){var u=e[o].match(r),a=$.trim(u[1]).replace(n,""),f=$.trim(u[2]).replace(n,"");i.push({title:a,lyrics:f})}var l=s(e.slice(-1)[0]),c=!1;if(l){c=l.keywords;i.slice(-1)[0].lyrics=l.lastLyrics}return{slides:i,keywords:c}}function s(e){var t=e.split(n);t=$.grep(t,function(e){var t=$.trim(e);return t.length>1?t:!1});if(t.length>2){var r=t.splice(2).join(", ").replace(/\r\n\t/g,""),i=t[1].match(/^\W*([\s\S]+)/m)[1];return{keywords:r,lastLyrics:i}}return!1}var e="songshowplus";parser.formats[e]={};parser.formats[e].testExtension=function(e){return/sbsong/i.test(e)};parser.formats[e].convert=function(e,t){var n=e.split("<Properties>")[0].split("%"),s=i(n),o=r(n[0],s.keywords,t);return{title:o.title,info:o.info,slides:s.slides}};var t="[\\xA0\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F]",n=new RegExp(t)})();(function(){function t(e){var t=[];e.each(function(e,n){var i=$(n),s=$.trim(i.attr("label")),o=i.find("rvtextelement").attr("rtfdata"),u=parser.utilities.decode(o),a=r(u);t.push({title:s,lyrics:a})});return t}function n(e){var t=["height","width","cclisongtitle","cclidisplay","versionnumber","doctype","creatorcode","lastdateused","usedcount","backgroundcolor","drawingbackgroundcolor"],n=[];$.each(e,function(e,r){$.inArray(r.name,t)<0&&r.value!==""&&n.push({name:r.name,value:r.value})});var r=new Date(Date.parse(e.lastdateused.value));isNaN(r.getTime())||n.push({name:"Last Used On",value:r});return n}function r(e){var t=/\{\*?\\[^{}]+}|[{}]|\\[A-Za-z]+\n?(?:-?\d+)?[ ]?/g,n=/\\\n/g,r=e.replace(t,""),i=r.replace(n,"\n"),s=i.trim();return s}var e="propresenter";parser.formats[e]={};parser.formats[e].testExtension=function(e){return/pro\d+/i.test(e)};parser.formats[e].convert=function(e,r){var i=$(e),s=i.get(0).attributes,o=i.children("slides").children(),u=typeof s.cclisongtitle=="string"&&s.cclisongtitle.length>0?s.cclisongtitle.value:r;return{title:u,info:n(s),slides:t(o)}}})();(function(){function n(e){var t=r(e);for(var n=0;n<e.slides.length;n++){var i=e.slides[n];t+=o(n,i.title,i.lyrics)}t+='</slides><timeline timeOffSet="0" selectedMediaTrackIndex="0" unitOfMeasure="60" duration="0" loop="0"><timeCues containerClass="NSMutableArray"></timeCues><mediaTracks containerClass="NSMutableArray"></mediaTracks></timeline><bibleReference containerClass="NSMutableDictionary"></bibleReference></RVPresentationDocument>';return t}function r(e){var t="",n="",r="",i="",s="",o="",u=new Date,a=u.getFullYear()+"-"+u.getMonth()+"-"+u.getDate()+"T"+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds();for(var f=0;f<e.info.length;f++){var l=e.info[f];if(/copyright/i.test(l.name)){var c=l.value.match(/(\d{4})(.*)/);if(c){c.length>1&&(i=c[1]);c.length>2&&(s=c[2])}else s=l.value}else if(/ccli/i.test(l.name))o=l.value;else if(/keywords/i.test(l.name))t=l.value;else if(/author|artist/i.test(l.name)){n=l.value;r=l.value}}return'<RVPresentationDocument height="768" width="1024" versionNumber="400" docType="0" creatorCode="1349676880" lastDateUsed="'+a+'" usedCount="0" category="Song" resourcesDirectory="" backgroundColor="0 0 0 1" drawingBackgroundColor="0" notes="'+t+'" artist="'+n+'" author="'+r+'" album="" CCLIDisplay="0" CCLIArtistCredits="" CCLISongTitle="'+e.title+'" CCLIPublisher="'+s+'" CCLICopyrightInfo="'+i+'" CCLILicenseNumber="'+o+'"><slides containerClass="NSMutableArray">'}function i(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function s(e){return'<RVDisplaySlide backgroundColor="0 0 0 0" enabled="1" highlightColor="0 0 0 0" hotKey="" label="" notes="" slideType="1" sort_index="'+e+'" UUID="'+i()+'" drawingBackgroundColor="0" serialization-array-index="'+e+'"><cues containerClass="NSMutableArray"></cues><displayElements containerClass="NSMutableArray"></displayElements></RVDisplaySlide>'}function o(e,t,n){var r=["{\\rtf1\\ansi\\ansicpg1252\\cocoartf1038\\cocoasubrtf320","{\\fonttbl\\f0\\fswiss\\fcharset0 Helvetica;}","{\\colortbl;\\red255\\green255\\blue255;}","\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\qc\\pardirnatural","","\\f0\\fs96 \\cf1 "+n.replace(/\r\n/g,"\\\n")+"}"].join("\n"),s=parser.utilities.encode(r),o=["",'<RVDisplaySlide backgroundColor="0 0 0 0" enabled="1" highlightColor="0 0 0 0" hotKey="" label="'+t+'" notes="" slideType="1" sort_index="'+e+'" UUID="'+i()+'" drawingBackgroundColor="0" serialization-array-index="'+e+'">','	<cues containerClass="NSMutableArray"></cues>','	<displayElements containerClass="NSMutableArray">','		<RVTextElement displayDelay="0" displayName="Default" locked="0" persistent="0" typeID="0" fromTemplate="0" bezelRadius="0" drawingFill="0" drawingShadow="0" drawingStroke="0" fillColor="1 1 1 1" rotation="0" source="" adjustsHeightToFit="0" verticalAlignment="0" RTFData="'+s+'" serialization-array-index="0">','			<_-RVRect3D-_position x="20" y="20" z="0" width="984" height="728"></_-RVRect3D-_position>','			<_-D-_serializedShadow containerClass="NSMutableDictionary">','				<NSCFNumber serialization-native-value="5" serialization-dictionary-key="shadowBlurRadius"></NSCFNumber>','				<NSCalibratedRGBColor serialization-native-value="0 0 0 0.5" serialization-dictionary-key="shadowColor"></NSCalibratedRGBColor>','				<NSCFString serialization-native-value="{3.53553, -3.53553}" serialization-dictionary-key="shadowOffset"></NSCFString>',"			</_-D-_serializedShadow>",'			<stroke containerClass="NSMutableDictionary">','				<NSCachedRGBColor serialization-native-value="0 0 0 1" serialization-dictionary-key="RVShapeElementStrokeColorKey"></NSCachedRGBColor>','				<NSCFNumber serialization-native-value="1" serialization-dictionary-key="RVShapeElementStrokeWidthKey"></NSCFNumber>',"			</stroke>","		</RVTextElement>","	</displayElements>","</RVDisplaySlide>"].join("\n");return o}function u(n,r){if(r.length>0){var i="btn-"+e+"-download-zip",s="btn-"+e+"-download-files",o="<h1>Converted "+r.length+" Song File"+(r.length>1?"s":"")+"!</h1>";if(r.length>1){o+="<button id='"+i+"' type='button' class='btn btn-large btn-primary'>Download as .zip</button>";o+=" or <button id='"+s+"' type='button' class='btn'>Download "+r.length+" individual files</button>"}else o+="<button id='"+s+"' type='button' class='btn btn-large btn-primary'>Download file</button>";n.html(o);$("#"+i).on("click",function(){var e=new JSZip;$.each(r,function(n,r){e.file(r.name+t,r.data)});var n=e.generate({type:"blob"});saveAs(n,"converted files.zip")});$("#"+s).on("click",function(){$.each(r,function(e,n){var r=new Blob([n.data],{type:"text/xml;charset=utf-8"});saveAs(r,n.name+t)})})}}var e="propresenter",t=".pro4";parser.outputs[e]=function(e,t){var r=[],i=[];$.each(t,function(e,t){try{r.push({name:t.name,data:n(t.data)})}catch(s){i.push(t.name)}});i.length&&parser.displayError(i.join(", "),"Error converting the following "+i.length+" songs!");u(e,r)}})();(function(){function n(e){var t="Title: "+e.title;for(var n=0;n<e.info.length;n++){var r=e.info[n];if(r.name&&r.value){t+="\r\n";t+=r.name+": "+r.value}}t+="\r\n\r\n";for(var n=0;n<e.slides.length;n++){var i=e.slides[n];t+=i.title;t+="\r\n";t+=i.lyrics;n<e.slides.length-1&&(t+="\r\n\r\n")}return t}function r(n,r){if(r.length>0){var i="btn-"+e+"-download-zip",s="btn-"+e+"-download-files",o="<h1>Converted "+r.length+" Song File"+(r.length>1?"s":"")+"!</h1>";if(r.length>1){o+="<button id='"+i+"' type='button' class='btn btn-large btn-primary'>Download as .zip</button>";o+=" or <button id='"+s+"' type='button' class='btn'>Download "+r.length+" individual files</button>"}else o+="<button id='"+s+"' type='button' class='btn btn-large btn-primary'>Download file</button>";n.html(o);$("#"+i).on("click",function(){var e=new JSZip;$.each(r,function(n,r){e.file(r.name+t,r.data)});var n=e.generate({type:"blob"});saveAs(n,"converted files.zip")});$("#"+s).on("click",function(){$.each(r,function(e,n){var r=new Blob([n.data],{type:"text/xml;charset=utf-8"});saveAs(r,n.name+t)})})}}var e="text",t=".txt";parser.outputs[e]=function(e,t){var i=[],s=[];$.each(t,function(e,t){try{i.push({name:t.name,data:n(t.data)})}catch(r){s.push(t.name)}});s.length&&parser.displayError(s.join(", "),"Error converting the following "+s.length+" songs!");r(e,i)}})();(function(){function t(e){var t='<h3 class="song-title">'+e.title+"</h3>";t+='<ul class="song-info">';for(var n=0;n<e.info.length;n++){var r=e.info[n];t+="<li><strong>"+r.name+":</strong> "+r.value+"</li>"}t+='</ul><ul class="slides-container thumbnails">';for(var n=0;n<e.slides.length;n++){var r=e.slides[n],i=r.title.length<1?"&nbsp;":r.title;t+='<li class="span3"><div class="thumbnail slide-content"><p class="slide-lyrics">'+r.lyrics+'</p><h6 class="slide-label">'+i+"</h6></div></li>"}t+="</ul>";return t}function n(e){var t=0;e.find(".slide-lyrics").each(function(e){$(this).height()>t&&(t=$(this).height())}).css({"min-height":t})}var e="display";parser.outputs[e]=function(e,r){$.each(r,function(r,i){var s=$(t(i.data));e.append(s);n(s)})}})();