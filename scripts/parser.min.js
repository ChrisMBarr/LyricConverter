var parser=function(){function i(){e=$("#drop-area");n=$("#error-display");r=$("#js-output");t=$("#begin");if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile|Windows Phone|Zune/i.test(navigator.userAgent)){a("Sorry, SongParserJS this cannot be used on mobile devices!","Unsupported Browser!");e.hide();r.hide()}else if(Modernizr.draganddrop&&window.FileReader){Modernizr.load({test:window.atob&&window.btoa,nope:"scripts/plugins/base64.js"});s();var i=$("#sidebar");i.width(i.width()).affix()}else{a("Sorry, you won't be able to use SongParserJS<br />because your browser does not support file Drag-N-Drop!<br/><br/>Try using a modern browser like <a href='www.google.com/chrome'>Google Chrome</a> instead!","Unsupported Browser!");e.hide();r.hide()}}function s(){e.fileDragAndDrop(function(e,t){o();try{var n=t.split("."),i=n[0],s=n.slice(-1)[0].toLowerCase();if($.isFunction(parser.formats[s])){var f=e.replace(/^data:.*;base64,/,""),l=u.decode(f),c=parser.formats[s](l,i);parser.outputs[r.val()]().run(c)}else{o();a("The file <strong>"+t+"</strong> cannot be parsed because <strong>."+s.toUpperCase()+"</strong> is not a supported file type!","Invalid Filetype!")}}catch(h){o();a("There was an error reading the file <strong>"+t+"</strong>","Error!")}})}function o(){n.empty().hide();t.hide();parser.outputs[r.val()]().resetUI()}function a(e,t){var r="";t&&t.length&&(r+="<h3>"+t+"</h3>");r+="<p>"+e+"</p>";n.show().html(r)}var e,t,n,r,u={decode:function(e){var t=window.atob(e);try{return decodeURIComponent(escape(t))}catch(n){return t}},encode:function(e){return window.btoa(unescape(encodeURIComponent(e)))}};$(i);return{utilities:u,displayError:a,formats:{},outputs:{}}}();(function(){function e(e){var t=[];e.each(function(e,r){var i=$(r),s=$.trim(i.attr("label")),o=i.find("rvtextelement").attr("rtfdata"),u=parser.utilities.decode(o),a=n(u);t.push({title:s,lyrics:a})});return t}function t(e){var t=["height","width","cclisongtitle","cclidisplay","versionnumber","doctype","creatorcode","lastdateused","usedcount","backgroundcolor","drawingbackgroundcolor"],n=[];$.each(e,function(e,r){$.inArray(r.name,t)<0&&r.value!==""&&n.push({name:r.name,value:r.value})});var r=new Date(Date.parse(e.lastdateused.value));isNaN(r.getTime())||n.push({name:"Last Used On",value:r});return n}function n(e){var t=/\{\*?\\[^{}]+}|[{}]|\\[A-Za-z]+\n?(?:-?\d+)?[ ]?/g,n=/\\\n/g,r=e.replace(t,""),i=r.replace(n,"\n"),s=i.trim();return s}parser.formats.pro4=function(n,r){var i=$(n),s=i.get(0).attributes,o=i.children("slides").children(),u=typeof s.cclisongtitle=="string"&&s.cclisongtitle.length>0?s.cclisongtitle.value:r;return{title:u,info:t(s),slides:e(o)}}})();(function(){function e(e,t,n){var i=e.split(r.invisibles);i=$.grep(i,function(e){var t=$.trim(e);return t.length>1?t:!1});/[0-9]{1,4}/.test(i[0])&&i.splice(0,1);var s=i[0].length>0?i[0]:n,o=[];o.push({name:"Artist/Author",value:i[1]});i[2]&&o.push({name:"Copyright",value:i[2].replace("$","")});i[3]&&o.push({name:"CCLI",value:i[3]});t&&o.push({name:"Keywords",value:t});return{info:o,title:s}}function t(e){var t=/^[\xA0\x00-\x09\x0B\x0C\x0E-\x1F\x7F]+.{1}[\xA0\x00-\x09\x0B\x0C\x0E-\x1F\x7F]+(.+)[\xA0\x00-\x09\x0B\x0C\x0E-\x1F\x7F]+\W*([\s\S]+)/m,i=[];for(var s=1;s<e.length;s++){var o=e[s].match(t),u=$.trim(o[1]),a=$.trim(o[2].replace(r.invisibles,""));i.push({title:u,lyrics:a})}var f=n(e.slice(-1)[0]),l=!1;if(f){l=f.keywords;i.slice(-1)[0].lyrics=f.lastLyrics}return{slides:i,keywords:l}}function n(e){var t=e.split(r.invisibles);t=$.grep(t,function(e){var t=$.trim(e);return t.length>1?t:!1});if(t.length>2){var n=t.splice(2).join(", "),i=t[1].match(/^\W*([\s\S]+)/m)[1];return{keywords:n,lastLyrics:i}}return!1}parser.formats.sbsong=function(n,r){var i=n.split("<Properties>")[0].split("%"),s=t(i),o=e(i[0],s.keywords,r);return{title:o.title,info:o.info,slides:s.slides}};var r={invisibles:/[\xA0\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/}})();parser.outputs.display=function(){function r(){e=$("#song-title");t=$("#song-info");n=$("#slides-container")}function i(r){e.text(r.title);r.slides.length>0&&n.show();for(var i=0;i<r.info.length;i++){var s=r.info[i];$("<li><strong>"+s.name+":</strong> "+s.value+"</li>").appendTo(t)}for(var i=0;i<r.slides.length;i++){var s=r.slides[i],o=s.title.length<1?"&nbsp;":s.title;$("<li class='span3'><div class='thumbnail slide-content'><p class='slide-lyrics'>"+s.lyrics+"</p><h6 class='slide-label'>"+o+"</h6></div></li>").appendTo(n)}}function s(){var e=0;n.find(".slide-lyrics").each(function(t){$(this).height()>e&&(e=$(this).height())}).css({"min-height":e})}var e,t,n;r();return{run:function(e){i(e);s()},resetUI:function(){e.text("");t.empty();n.empty().hide()}}};